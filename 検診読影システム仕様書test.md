# 検診画像読影システム

- 集団検診で発生する大量の胸部Ｘ線検査画像（CR画像）、胃部Ｘ線検査画像（RF画像）を連続的に表示し、迅速に読影結果を入力するシステムである。

- 表示モニターは、2Mモノクロ縦置き（1200X1600）の高精細・高輝度モニターの使用を想定する。
画像の切り替わりは、高速に行われ、かつちらつきを最低限に抑える。

- 読影結果入力で使用する部位名、所見名、判定等の用語および依頼施設管理用コード、入力項目数は利用施設での差異が大きいため、汎用ファイル形式で記述・編集された設定ファイルにより規定される。

胸部Ｘ線検査表示例

![胸部Ｘ線写真](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_0.1.png "胸部Ｘ線画像表示例")

胃部Ｘ線検査表示例

![胃部Ｘ線写真](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_0.2.png)



## 1. 検査画像のupload

- 画像は、依頼施設ごとのloookrec-uploaderにてuploadする。

- upload時に、撮影日、study time、検査種、ID、名前、study time、series番号、study instance UID、series instance UID、生年月日、性別、年齢、station name、institution name、をTag情報から読み込んでLookRecの画像管理ファイルに登録する。

- 基本的には、CRは1枚or2枚（正面、正面＋側面）、RFは8枚～14枚が1シリーズである。

## 2. 読影依頼登録

- オーダー登録時に読影対象群を選択し、読影対象名を記入してオーダー登録を行う。1検査ごとの個別読影依頼ではなく、読影対象群の複数検査（数件～数百件）を一括依頼する。読影対象名は、 LookRecの読影管理ファイルに記録される。

- オーダー登録する際に、その読影対象群の読影を依頼する読影医師を指定する。指定した読影医師に、依頼情報（ LookRec上の読影対象群情報）をメールにて送信することができる。

- オーダー登録時に読影医師の指定を行わず、オーダー登録完了後に指定・変更・削除することもできる。

- オーダー登録時に、単独読影か二重読影かを指定する。

- 二重読影の場合は、2名の読影医師を指定し依頼することができる。一番目の読影が完了したのちに、二番目の読影医師に読影依頼を行うこともできる。その場合、二番目の読影医師は一番目の読影結果を確認しながら読影を行うことができる。


### 2.1 読影依頼登録

- LookRecの新規オーダー登録画面から、胸部Ｘ線検診を選択してオーダー登録を開始する。

- 検査日を入力して、検査画像一覧ボタンをクリックしてアップロード一覧画面を表示する。

![オーダー登録画面](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_1.1.png)


・アップロード一覧画面に表示された検査の中から、station name、institution name 等で並び替えを行い、読影対象群を選択する。
読影対象検査が複数ページとなる場合は、ページごとに[全てチェック]ボタンにて全選択する。選択が完了した後、[検査を完了]ボタンをクリックする。

![アップロード一覧画面](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_1.2.png)


・読影対象群の検査を確認し、読影対象名を記入する。

・単独読影か二重読影かを指定する。

・その読影対象群の読影を依頼する読影医師を指定する。
　指定した読影医師に、依頼情報（ LookRec上の読影対象群情報）をメールにて送信する。
　オーダー登録時に読影医師の指定を行わず、オーダー登録完了後に指定・変更・削除することもできる。

・二重読影の場合は、2名の読影医師を指定し依頼する。
　一番名の読影が完了したのちに、二番目の読影医師に読影依頼を行うこともできる。その場合、二番目の読影医師は一番の読影結果を確認しながら読影を行うことができる。

![読影一覧画面](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_1.3.png)

## 3. 読影準備

### 3.1 依頼情報による読影開始

- 読影医師は、読影依頼のメールに記載された依頼情報をクリックすることで検診画像読影システムが起動し、読影対象群の基本表示画面が表示され、読影を開始することができる。

- 読影対象群の読影を中断した場合、再度依頼情報をクリックすることで中断した検査からの読影ができる。


### 3.2 検索による読影開始

- 読影医師は、LookRecの読影一覧画面から依頼日、検査日、読影対象名で検索して読影を開始することができる。



## 4. 画像表示

- 画像表示画面の操作は、コメントの入力以外の全ての操作をマウスのみで行うことができる。

- 読影対象群の１件目の読影結果を確定すると、読影結果、読影医師名、読影日時を読影管理ファイルに登録し、次の検査画像を表示する。最後の検査の読影結果が登録されると読影完了メッセージを表示する。

- 画像連携
表示している画像と結果入力部はいかなる場合も完全に一致する。

- 過去履歴画像との比較読影
通常は、過去履歴の有無を確認できる最小限の表示を行い、操作により詳細（大きく）画像表示する。

- 画像操作機能
キー画像作成操作（キー画像保存、アノーテーション選択、消去、黒丸描画、白丸描画、矢印描画、距離計測）、画像表示操作（ルーペ、パン、ズーム処理）を実装する。


### 4.1 基本表示画面

基本画像表示操作

- マウスのホイールで画像の切り替えを行い、マウスの左ドラッグでW/W、W/Lの調整を行う。
- 右ドラッグはルーペ表示がデフォルトである。
- W/W、W/Lのドラッグ方向および変化量は、ユーザーごと、モダリティごとにプリセット設定できる。

![基本表示画面](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.1.png)




### 4.2 管理画面

![管理画面](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.png)

#### 4.2.1 検査画像情報枠

![検査画像情報枠](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.1.png)

検査日、読影対象名、被検者のID番号、氏名、年齢、性別を表示する。

#### 4.2.2 件数表示枠

![件数表示枠](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.2.png)

現在表示している検査の順位　/　未読影の検査数　/　総検査数を表示する。

#### 4.2.3 検査履歴枠
##### 過去の検査履歴がある場合に件数を表示する。

![検査履歴枠1](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.1.png)

![検査履歴枠2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.2.png)




##### 検査履歴画像が有る場合は、履歴制御枠が表示される。

![履歴表示枠1](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.3.png)



履歴制御枠で前回の検査を選択した場合（複数の履歴検査がある場合、前回の検査が表示される）

![履歴表示枠2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.4.png)

- 前回の画像が表示される。
- 前回の読影結果が表示される。
- 管理画面の右端に「過去画像表示」と表示される。


履歴制御枠で前々回の検査を選択した場合

![履歴表示枠3](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.5.png)

- 前々回の画像が表示される。
- 前々回の読影結果が表示される。
- 管理画面の右端に「過去画像表示」と表示される。

##### 過去の読影結果が第二所見、第三所見まで有る場合には、読影結果表示欄を２段、３段として表示する。





#### 4.2.4 異常なしボタン

![履歴表示枠3](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.6.png)

異常なしボタンをクリックすると、読影結果（異常なし）と読影医師名が登録され、次検査が表示される。


#### 4.2.5 矢頭ボタン

![履歴表示枠3](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.7.png)

左側のボタンをクリックすると、一つ前の検査に戻る。右側のボタンをクリックすると、一つ先の検査に進む。


#### 4.2.6 詳細ボタン

![履歴表示枠3](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.8.png)

ボタンをクリックすると、詳細結果入力画面を表示する。


#### 4.2.7 医師名枠

![履歴表示枠3](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.9.png)

現在の読影医師名を表示する。

#### 4.2.8 終了ボタン

![履歴表示枠3](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.2.3.10.png)

ボタンをクリックすると、読影結果を保存するか否かを確認した後、読影を終了する。


### 4.3 画像処理枠

#### 4.3.1 キー画像作成処理ボタン＆パン・ズームボタン

![キー画像作成＆パン・ズームボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.1.png)

中央部のボタン配置の無い部分に、第一読影の所見を表示する。

### 4.3.2 キー画像作成処理ボタン

![キー画像作成処理ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.png)

キー画像作成操作

- 左クリックで選択したボタン操作を、左クリックおよびドラッグで操作する。
- 右クリックすると、ルーペ表示されドラッグして場所を移動する。
- 左クリックで選択した操作は、ルーペボタンのクリックによりループ表示に戻る。


### 4.3.2.1 キー画像撮影ボタン

![キー画像作成処理ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.1.png)

表示している画像をアノーテーション、パン・ズーム、WW/WLを反映した状態でキー画像として保存し、キー画像欄に表示する。


### 4.3.2.2 消しゴムボタン

![消しゴムボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.2.png)

アノーテーションを削除する。


### 4.3.2.3 選択ボタン

![選択ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.3.png)

矩形で囲まれたアノーテーションを選択する。

### 4.3.2.4 黒丸ボタン

![黒丸ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.4.png)

黒の楕円形アノーテーションを描画する。

![黒丸ボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.4.2.png)

### 4.3.2.5 白丸ボタン

![白丸ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.5.png)

白の楕円形アノーテーションを描画する。

![白丸ボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.5.2.png)

### 4.3.2.6 矢印ボタン

![矢印ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.6.png)

左クリックした位置を始点とし、左ドラッグを終えた位置を終点とする白の矢印アノーテーションを描画する。

![矢印ボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.6.2.png)

### 4.3.2.7 物差ボタン

![物差ボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.7.png)

左クリックした位置を始点とし、左ドラッグを終えた位置を終点とする直線を表示して、その距離をmm単位で表示・描画する。

![物差ボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.2.7.2.png)


### 4.3.3 パン・ズームボタン

![パン・ズームボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.png)

画像表示操作（デフォルトでルーペが選択される）
左クリックで選択したボタン操作を、右ドラッグで操作する。


### 4.3.3.1 ルーペボタン

![ルーペボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.1.png)

設定した正方形の範囲をズーム表示する。

![ルーペボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.1.2.png)

### 4.3.3.2 パンボタン

![パンボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.2.png)

表示画像のパン操作を行う。

![パンボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.2.2.png)

### 4.3.3.3 ズームボタン

![ズームボタン](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.3.png)

画像全体をズーム表示する。

![ズームボタン2](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.3.3.3.2.png)

#### アノーテーションとルーペの太さ・大きさ・倍率はユーザーごとにプリセット設定できる。
#### サムネール画像をクリックすると、初期状態の画像が表示される。


### 4.4 サムネール表示枠

- サムネールは同一シリーズの画像を最大14個（設定にて可変）表示する。

- サムネール画像をクリックすると、その画像が画像表示枠に表示される。

![サムネール表示枠](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_4.4.png)



## 5. 読影結果入力

- 症例の大部分を占める正常例では、基本表示画面上の異常なしボタンをクリックすることで、読影結果（異常なし）が登録され、次検査が表示される。
- 有所見の場合、詳細結果入力ボタンをクリックすることで、詳細結果入力画面が表示される。
- 結果入力は、最大５項目（部位、位置、所見、指示、判定）の入力枠にそれぞれの登録用語から選択入力する。（デフォルトは、部位、所見、判定の３項目）
- 入力枠の表示位置、サイズはユーザーごとに設定できる。
- 登録用語の編集（依頼施設管理用コードを含む）は、迅速な修正・追加作業を考慮し、汎用ファイル形式で記述・編集された設定ファイルにより運用される。
- 結果入力画面は、属性表示（検査日、ID、氏名、年齢、性別、読影対象名）、異常なしボタン、詳細結果入力ボタン、検査済み件数表示、読影依頼件数を表示できる最小限の画面とする。（視点移動・入力操作の省力化を確保する）


### 5.1 詳細結果入力画面


![詳細結果入力画面](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_5.1.png)

履歴制御枠で過去の検査を選択した場合、該当する画像と読影結果が表示される

- 過去の読影結果、第一読影の結果、第一読影にて作成されたキー画像を確認し、第二読影を行う。
- 「結果コピー」ボタンのクリックすれば、第一読影結果が第二読影結果にコピーされる。


### 5.1.2 詳細結果入力欄

#### 5.1.2.1 第一読影結果入力欄

![第一読影結果入力欄](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_5.1.2.1.png)

- 入力は、第一所見、第二所見、第三所見の順に入力される。
- 第一所見の入力は必須となる。
- 入力した内容は、右端の消しゴムボタンをクリックすると消去される。
- コメント欄はテキスト入力（任意入力）

結果コピーボタン
第二読影時に、第一読影結果を第二読影結果にコピーする。

#### 5.1.2.2 第二読影結果入力欄

![第二読影結果入力欄](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_5.1.2.2.png)

単独読影の設定の場合は、第一読影結果入力欄のみ表示され、第二読影結果入力欄は表示されない。


![一所見入力欄](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_5.1.2.3.png)

第一所見のみの場合（第二、第三所見は設定により、諸略される）


### 5.2 部位選択欄

![部位選択欄1](/Users/takayoshi.n/Desktop/健診読影システム仕様/image/image_5.2.1.png)

部位名をクリックすると、その値が第一所見、第二所見、第三所見の部位項に順に入力される。

部位名の登録、配置およびシェーマは、設定ファイルに記述された内容を反映する。
設定ファイルは、textやjpeg等汎用なファイル形式とする。


### 5.3 所見選択欄

所見名は、タブの切り替えにより、グループごとに表示され、所見名ボタンをクリックすると、その値が第一所見、第二所見、第三所見の部位項に順に入力される。

所見名の登録、配置、グループ分けは、設定ファイルに記述された内容を反映する。
設定ファイルは、text等汎用なファイル形式とする。


### 5.4 判定選択欄

判定名は、判定名ボタンをクリックすると、その値が第一所見、第二所見、第三所見の部位項に順に入力される。

判定名の登録、配置は、設定ファイルに記述された内容を反映する。
設定ファイルは、text等汎用なファイル形式とする。

全ての部位、所見、判定を入力後、決定ボタンをクリックすると結果入力が確定し、次の検査に進む。


### 5.5 読影画像表示枠

今回の読影対象画像が表示される。
マウスホイールによる画像切り替え、サムネール画像からの選択表示ができる。
マウスの左ドラッグでW/W、W/Lの調整を行う。

キー画像作成操作、画像表示操作は、基本表示画面と同様である。


### 5.6 過去画像表示枠

前回の履歴画像が表示される。
マウスホイールによる画像切り替え、サムネール画像からの選択表示ができる。
マウスの左ドラッグでW/W、W/Lの調整を行う。
キー画像作成操作、画像表示操作は、基本表示画面と同様である。

履歴制御枠で前回以前の検査を選択した場合、
・選択した画像が表示される。
・選択した画像の読影結果が表示される。
・管理画面の右端に「過去画像表示」と表示される。



### 5.7 設定ファイル　サンプル

設定ファイルは、部位、位置、所見（１ ～５）、指示、判定のそれぞれ５０個の記載・編集ができる汎用形式のファイルであること。
サンプルファイルはwebアプリではなく、モニタ画面上の、xy座標の指定により位置や大きさを指定しているものである。同様の表示ができれば、座標指定を行う必要はない。



## 6 読影結果出力

・読影対象群の読影がすべて完了すると、 LookRecの読影管理ファイルに読影結果、読影医師名が登録され、自動的に利用施設の担当者に完了通知メールが送信される。


結果一覧画面に表示された検査の中から、検査日、読影対象名で並び替えを行い、読影対象群を選択する。
読影対象検査が複数ページとなる場合は、ページごとに[全てチェック]ボタンにて全選択する。
選択が完了した後、[CSV]、[一覧PDF]、[詳細PDF]ボタンをクリックして結果を出力する。


### 6.1.1 一覧結果出力（一覧PDF）

・読影結果出力は、1検査ごとの結果出力だけでなく、読影対象群の複数検査（数件～数百件）を一覧形式でPDF出力する。
・読影結果出力は、読影対象群の一覧結果出力と、有所見を抽出した1検査ごとの詳細結果PDF出力を行うことができる。
・読影結果出力はPDF出力だけでなく、読影結果の値、コメント、設定ファイルに記述した値のコードを検査画像情報とともにcsv出力ができる。


### 6.1.2 詳細結果出力（詳細PDF）
